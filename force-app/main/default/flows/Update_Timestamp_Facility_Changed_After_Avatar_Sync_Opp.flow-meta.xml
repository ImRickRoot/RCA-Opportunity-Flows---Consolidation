<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>58.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <description>Sets the FacilityChangedSinceLastSyncedToAvatar__c field to the current date/time using $Flow.CurrentDateTime. This timestamp captures when the facility was changed after the record had already been synced to Avatar, creating an audit trail of post-sync facility modifications. This information is critical for Avatar integration troubleshooting, ensuring the Avatar system is updated with the new facility assignment, and tracking data synchronization issues.</description>
        <name>updateTimeStamp</name>
        <label>Stamp Facility Change Timestamp</label>
        <locationX>176</locationX>
        <locationY>287</locationY>
        <assignmentItems>
            <assignToReference>$Record.FacilityChangedSinceLastSyncedToAvatar__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDateTime</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <description>AUDIT TRAIL: Records a timestamp when the Facility field changes on an opportunity that has already been synced to Avatar. Triggers before save when: (1) Facility__c changes, (2) Sync_to_Avatar__c is TRUE, and (3) StageName is 'Scheduled for Admission'. Sets FacilityChangedSinceLastSyncedToAvatar__c to current date/time. This audit field tracks post-sync facility changes, which is critical for Avatar integration monitoring and ensuring the EHR system is updated with the correct facility assignment. Helps troubleshoot sync issues and maintain data consistency between Salesforce and Avatar. Refactored from Case to Opportunity object.</description>
    <environments>Default</environments>
    <interviewLabel>Update Timestamp: When Facility is Changed after it was synced to Avatar {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Update Timestamp: Facility Changed After Avatar Sync (Opp)</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>updateTimeStamp</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Facility__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Sync_to_Avatar__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>StageName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Scheduled for Admission</stringValue>
            </value>
        </filters>
        <object>Opportunity</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordBeforeSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
